<?xml version='1.0' encoding='UTF-8'?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 49.240002 50" id="fuxaWidget" style="border: none !important; outline: none !important; box-shadow: none !important; margin: 0; padding: 0; background: transparent;" width="100%" height="100%">
  <g id="fuxaSymbol">
    <defs id="defs1"/>
    <g data-cell-id="gQ551Ar7PwXLAaA90adm-532" id="g6" transform="translate(-0.5,-0.5)">
      <g id="cell-gQ551Ar7PwXLAaA90adm-532">
        <g transform="translate(0.5,0.5)" id="g5">
          <path d="M 2.23,0 C 1.01,0 0,1.01 0,2.23 V 47.77 C 0,48.99 1.01,50 2.23,50 h 20.81 c 0.61,0 1.17,-0.25 1.58,-0.66 0.4,0.41 0.96,0.66 1.58,0.66 h 20.81 c 1.22,0 2.23,-1.01 2.23,-2.23 V 2.23 C 49.24,1.01 48.23,0 47.01,0 H 26.2 C 25.58,0 25.02,0.25 24.62,0.66 24.21,0.25 23.65,0 23.04,0 Z m 0,1.3 h 20.81 c 0.52,0 0.93,0.4 0.93,0.93 V 40.36 H 1.3 V 2.23 C 1.3,1.7 1.7,1.3 2.23,1.3 Z m 23.97,0 h 20.81 c 0.52,0 0.93,0.4 0.93,0.93 V 40.37 L 25.27,40.36 V 2.23 C 25.27,1.7 25.67,1.3 26.2,1.3 Z M 3.82,3.1 c -0.7,0 -1.29,0.58 -1.29,1.28 v 5.46 c 0,0.71 0.59,1.29 1.29,1.29 h 17.99 c 0.71,0 1.29,-0.58 1.29,-1.29 V 4.38 C 23.1,3.68 22.52,3.1 21.81,3.1 Z m 23.97,0 c -0.7,0 -1.29,0.58 -1.29,1.28 v 5.46 c 0,0.71 0.59,1.29 1.29,1.29 h 17.99 c 0.71,0 1.29,-0.58 1.29,-1.29 V 4.38 C 47.07,3.68 46.49,3.1 45.78,3.1 Z M 3.83,4.4 H 21.8 V 9.83 H 3.83 Z m 23.97,0 H 45.77 V 9.83 H 27.8 Z M 16.45,5.5 C 16.28,5.5 16.11,5.56 15.99,5.69 15.87,5.81 15.8,5.97 15.8,6.15 V 8.3 c 0,0.17 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 C 17.03,8.64 17.1,8.47 17.1,8.3 V 6.15 C 17.1,5.97 17.03,5.81 16.91,5.69 16.79,5.56 16.62,5.5 16.45,5.5 Z m 1.61,0 c -0.17,0 -0.34,0.06 -0.46,0.19 -0.12,0.12 -0.19,0.28 -0.19,0.46 V 8.3 c 0,0.17 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 0.12,-0.12 0.19,-0.29 0.19,-0.46 V 6.15 C 18.71,5.97 18.64,5.81 18.52,5.69 18.4,5.56 18.23,5.5 18.06,5.5 Z m 1.61,0 c -0.17,0 -0.34,0.06 -0.46,0.19 -0.12,0.12 -0.19,0.28 -0.19,0.46 V 8.3 c 0,0.17 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 0.12,-0.12 0.19,-0.29 0.19,-0.46 V 6.15 C 20.32,5.97 20.25,5.81 20.13,5.69 20.01,5.56 19.84,5.5 19.67,5.5 Z m 20.75,0 c -0.17,0 -0.34,0.06 -0.46,0.19 -0.12,0.12 -0.19,0.28 -0.19,0.46 V 8.3 c 0,0.17 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 C 41,8.64 41.07,8.47 41.07,8.3 V 6.15 C 41.07,5.97 41,5.81 40.88,5.69 40.76,5.56 40.59,5.5 40.42,5.5 Z m 1.61,0 c -0.17,0 -0.34,0.06 -0.46,0.19 -0.12,0.12 -0.19,0.28 -0.19,0.46 V 8.3 c 0,0.17 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 0.12,-0.12 0.19,-0.29 0.19,-0.46 V 6.15 C 42.68,5.97 42.61,5.81 42.49,5.69 42.37,5.56 42.2,5.5 42.03,5.5 Z m 1.61,0 c -0.17,0 -0.34,0.06 -0.46,0.19 -0.12,0.12 -0.19,0.28 -0.19,0.46 V 8.3 c 0,0.17 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 0.12,-0.12 0.19,-0.29 0.19,-0.46 V 6.15 C 44.29,5.97 44.22,5.81 44.1,5.69 43.98,5.56 43.81,5.5 43.64,5.5 Z M 6,5.94 C 5.32,5.94 4.77,6.48 4.77,7.16 4.77,7.84 5.32,8.38 6,8.38 6.67,8.38 7.22,7.84 7.22,7.16 7.22,6.48 6.67,5.94 6,5.94 Z m 23.97,0 c -0.68,0 -1.23,0.54 -1.23,1.22 0,0.68 0.55,1.22 1.23,1.22 0.67,0 1.22,-0.54 1.22,-1.22 0,-0.68 -0.55,-1.22 -1.22,-1.22 z M 3.82,12.41 c -0.7,0 -1.29,0.58 -1.29,1.29 v 5.45 c 0,0.71 0.59,1.29 1.29,1.29 h 17.99 c 0.71,0 1.29,-0.58 1.29,-1.29 V 13.7 c 0,-0.71 -0.58,-1.29 -1.29,-1.29 z m 23.97,0 c -0.7,0 -1.29,0.58 -1.29,1.29 v 5.45 c 0,0.71 0.59,1.29 1.29,1.29 h 17.99 c 0.71,0 1.29,-0.58 1.29,-1.29 V 13.7 c 0,-0.71 -0.58,-1.29 -1.29,-1.29 z M 3.83,13.71 H 21.8 v 5.43 H 3.83 Z m 23.97,0 h 17.97 v 5.43 H 27.8 Z m -11.35,1.1 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.17 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 0.12,-0.12 0.19,-0.29 0.19,-0.46 v -2.15 c 0,-0.17 -0.07,-0.34 -0.19,-0.46 -0.12,-0.12 -0.29,-0.19 -0.46,-0.19 z m 1.61,0 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.17 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 0.12,-0.12 0.19,-0.29 0.19,-0.46 v -2.15 c 0,-0.17 -0.07,-0.34 -0.19,-0.46 -0.12,-0.12 -0.29,-0.19 -0.46,-0.19 z m 1.61,0 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.17 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 0.12,-0.12 0.19,-0.29 0.19,-0.46 v -2.15 c 0,-0.17 -0.07,-0.34 -0.19,-0.46 -0.12,-0.12 -0.29,-0.19 -0.46,-0.19 z m 20.75,0 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.17 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 0.12,-0.12 0.19,-0.29 0.19,-0.46 V 15.46 C 41.07,15.29 41,15.12 40.88,15 40.76,14.88 40.59,14.81 40.42,14.81 Z m 1.61,0 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.17 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 0.12,-0.12 0.19,-0.29 0.19,-0.46 v -2.15 c 0,-0.17 -0.07,-0.34 -0.19,-0.46 -0.12,-0.12 -0.29,-0.19 -0.46,-0.19 z m 1.61,0 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.17 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 0.12,-0.12 0.19,-0.29 0.19,-0.46 V 15.46 C 44.29,15.29 44.22,15.12 44.1,15 43.98,14.88 43.81,14.81 43.64,14.81 Z M 6,15.25 c -0.68,0 -1.23,0.55 -1.23,1.22 0,0.68 0.55,1.23 1.23,1.23 0.67,0 1.22,-0.55 1.22,-1.23 C 7.22,15.8 6.67,15.25 6,15.25 Z m 23.97,0 c -0.68,0 -1.23,0.55 -1.23,1.22 0,0.68 0.55,1.23 1.23,1.23 0.67,0 1.22,-0.55 1.22,-1.23 0,-0.32 -0.13,-0.63 -0.36,-0.86 -0.23,-0.23 -0.54,-0.36 -0.86,-0.36 z M 3.82,21.72 c -0.7,0 -1.29,0.58 -1.29,1.29 v 5.46 c 0,0.7 0.59,1.29 1.29,1.29 h 17.99 c 0.71,0 1.29,-0.59 1.29,-1.29 v -5.46 c 0,-0.71 -0.58,-1.29 -1.29,-1.29 z m 23.97,0 c -0.7,0 -1.29,0.58 -1.29,1.29 v 5.46 c 0,0.7 0.59,1.29 1.29,1.29 h 17.99 c 0.71,0 1.29,-0.59 1.29,-1.29 v -5.46 c 0,-0.71 -0.58,-1.29 -1.29,-1.29 z M 3.83,23.02 H 21.8 v 5.44 H 3.83 Z m 23.97,0 h 17.97 v 5.44 H 27.8 Z m -11.35,1.1 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.17 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 0.12,-0.12 0.19,-0.28 0.19,-0.46 v -2.15 c 0,-0.17 -0.07,-0.34 -0.19,-0.46 -0.12,-0.12 -0.29,-0.19 -0.46,-0.19 z m 1.61,0 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.18 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 0.12,-0.12 0.19,-0.29 0.19,-0.46 v -2.15 c 0,-0.17 -0.07,-0.34 -0.19,-0.46 -0.12,-0.12 -0.29,-0.19 -0.46,-0.19 z m 1.61,0 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.17 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 0.12,-0.12 0.19,-0.28 0.19,-0.46 v -2.15 c 0,-0.17 -0.07,-0.34 -0.19,-0.46 -0.12,-0.12 -0.29,-0.19 -0.46,-0.19 z m 20.75,0 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.18 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 0.12,-0.12 0.19,-0.29 0.19,-0.46 v -2.15 c 0,-0.17 -0.07,-0.34 -0.19,-0.46 -0.12,-0.12 -0.29,-0.19 -0.46,-0.19 z m 1.61,0 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.17 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 0.12,-0.12 0.19,-0.28 0.19,-0.46 v -2.15 c 0,-0.17 -0.07,-0.34 -0.19,-0.46 -0.12,-0.12 -0.29,-0.19 -0.46,-0.19 z m 1.61,0 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.18 0.07,0.34 0.19,0.46 0.12,0.12 0.29,0.19 0.46,0.19 0.17,0 0.34,-0.07 0.46,-0.19 0.12,-0.12 0.19,-0.29 0.19,-0.46 v -2.15 c 0,-0.17 -0.07,-0.34 -0.19,-0.46 -0.12,-0.12 -0.29,-0.19 -0.46,-0.19 z M 6,24.56 c -0.68,0 -1.23,0.55 -1.23,1.22 0,0.33 0.13,0.64 0.36,0.87 0.23,0.23 0.54,0.36 0.87,0.36 0.32,0 0.63,-0.13 0.86,-0.36 0.23,-0.23 0.36,-0.54 0.36,-0.87 0,-0.67 -0.55,-1.22 -1.22,-1.22 z m 23.97,0 c -0.68,0 -1.23,0.55 -1.23,1.22 0,0.33 0.13,0.64 0.36,0.87 0.23,0.23 0.54,0.36 0.87,0.36 0.32,0 0.63,-0.13 0.86,-0.36 0.23,-0.23 0.36,-0.54 0.36,-0.87 0,-0.67 -0.55,-1.22 -1.22,-1.22 z M 3.82,31.03 c -0.7,0 -1.29,0.59 -1.29,1.29 v 5.46 c 0,0.7 0.59,1.29 1.29,1.29 h 17.99 c 0.71,0 1.29,-0.59 1.29,-1.29 v -5.46 c 0,-0.7 -0.58,-1.29 -1.29,-1.29 z m 23.97,0 c -0.7,0 -1.29,0.59 -1.29,1.29 v 5.46 c 0,0.7 0.59,1.29 1.29,1.29 h 17.99 c 0.71,0 1.29,-0.59 1.29,-1.29 v -5.46 c 0,-0.7 -0.58,-1.29 -1.29,-1.29 z M 3.83,32.33 H 21.8 v 5.44 H 3.83 Z m 23.97,0 h 17.97 v 5.44 H 27.8 Z m -11.35,1.1 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.18 0.07,0.34 0.19,0.46 0.12,0.13 0.29,0.19 0.46,0.19 0.17,0.01 0.34,-0.06 0.46,-0.19 0.12,-0.12 0.19,-0.28 0.19,-0.46 v -2.15 c 0,-0.17 -0.07,-0.34 -0.19,-0.46 -0.12,-0.12 -0.29,-0.19 -0.46,-0.19 z m 1.61,0 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.18 0.07,0.34 0.19,0.46 0.12,0.13 0.29,0.2 0.46,0.19 0.17,0 0.34,-0.06 0.46,-0.19 0.12,-0.12 0.19,-0.28 0.19,-0.46 v -2.15 c 0,-0.17 -0.07,-0.34 -0.19,-0.46 -0.12,-0.12 -0.29,-0.19 -0.46,-0.19 z m 1.61,0 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.18 0.07,0.34 0.19,0.46 0.12,0.13 0.29,0.19 0.46,0.19 0.17,0.01 0.34,-0.06 0.46,-0.19 0.12,-0.12 0.19,-0.28 0.19,-0.46 v -2.15 c 0,-0.17 -0.07,-0.34 -0.19,-0.46 -0.12,-0.12 -0.29,-0.19 -0.46,-0.19 z m 20.75,0 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.18 0.07,0.34 0.19,0.46 0.12,0.13 0.29,0.2 0.46,0.19 0.17,0 0.34,-0.06 0.46,-0.19 0.12,-0.12 0.19,-0.28 0.19,-0.46 v -2.15 c 0,-0.17 -0.07,-0.34 -0.19,-0.46 -0.12,-0.12 -0.29,-0.19 -0.46,-0.19 z m 1.61,0 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.18 0.07,0.34 0.19,0.46 0.12,0.13 0.29,0.19 0.46,0.19 0.17,0.01 0.34,-0.06 0.46,-0.19 0.12,-0.12 0.19,-0.28 0.19,-0.46 v -2.15 c 0,-0.17 -0.07,-0.34 -0.19,-0.46 -0.12,-0.12 -0.29,-0.19 -0.46,-0.19 z m 1.61,0 c -0.17,0 -0.34,0.07 -0.46,0.19 -0.12,0.12 -0.19,0.29 -0.19,0.46 v 2.15 c 0,0.18 0.07,0.34 0.19,0.46 0.12,0.13 0.29,0.2 0.46,0.19 0.17,0 0.34,-0.06 0.46,-0.19 0.12,-0.12 0.19,-0.28 0.19,-0.46 v -2.15 c 0,-0.17 -0.07,-0.34 -0.19,-0.46 -0.12,-0.12 -0.29,-0.19 -0.46,-0.19 z M 6,33.87 c -0.68,0 -1.23,0.55 -1.23,1.23 0,0.67 0.55,1.22 1.23,1.22 0.67,0 1.22,-0.55 1.22,-1.22 0,-0.68 -0.55,-1.23 -1.22,-1.23 z m 23.97,0 c -0.68,0 -1.23,0.55 -1.23,1.23 0,0.67 0.55,1.22 1.23,1.22 0.67,0 1.22,-0.55 1.22,-1.22 0,-0.68 -0.55,-1.23 -1.22,-1.23 z M 1.3,41.66 h 22.67 v 6.11 c 0,0.53 -0.41,0.93 -0.93,0.93 H 2.23 C 1.7,48.7 1.3,48.3 1.3,47.77 Z m 23.97,0 22.67,0.01 v 6.1 c 0,0.53 -0.41,0.93 -0.93,0.93 H 26.2 c -0.53,0 -0.93,-0.4 -0.93,-0.93 z m -3.63,1.04 c -0.77,0 -1.4,0.63 -1.4,1.4 0,0.76 0.63,1.4 1.4,1.4 0.77,0 1.4,-0.64 1.4,-1.4 0,-0.77 -0.63,-1.4 -1.4,-1.4 z m 23.97,0 c -0.76,0 -1.4,0.63 -1.4,1.4 0,0.76 0.64,1.4 1.4,1.4 0.77,0 1.4,-0.64 1.4,-1.4 0,-0.77 -0.63,-1.4 -1.4,-1.4 z m -23.97,1.11 c 0.17,0 0.29,0.12 0.29,0.29 0,0.17 -0.12,0.29 -0.29,0.29 -0.17,0 -0.29,-0.12 -0.29,-0.29 0,-0.17 0.12,-0.29 0.29,-0.29 z m 23.97,0 c 0.17,0 0.29,0.12 0.29,0.29 0,0.17 -0.12,0.29 -0.29,0.29 -0.17,0 -0.29,-0.12 -0.29,-0.29 0,-0.17 0.12,-0.29 0.29,-0.29 z" fill="#000000" stroke="none" pointer-events="all" id="path4"/>
        </g>
      </g>
    </g>
  </g>
  <script type="text/javascript"><![CDATA[/*
    # =============================================
    # ===             How to Use                ===
    # =============================================

    Variables with the following prefix:

    _pb_ = bool   parameter ( true or false )
    _pn_ = number parameter ( Int, Float, Real etc )
    _ps_ = string parameter ( string can be entered directly )
    _pc_ = color parameter in hex color code ( #00ff00ff )

    Indicate variable type to be used in Fuxa Properties and binding of Tags, Important! they have to be place within:

    //!export-start
    let _pn_setState = 0;
    //!export-end

    There are 2x Functions to handle sending and receiving data between Fuxa and the SVG

    // Recieve Variables From Fuxa
    function putValue(id, value) { } 
    
    // Send Variables To Fuxa
    function postValue(id, value) {
      console.error('Not defined!');
    }

    The ID is the name of the variable _pn_setState for example and value is the value to be sent or received from Fuxa


    This SVG uses an INT/Number Variable to change the State and State of the SVG:

    0 = Off
    1 = Run
    2 = Warning
    3 = Fault
    4 = Invalid
    5 = Spare

    You can also use the bool field and this will change the state between 0 = off and 1 = run 

    You can also set the color for each state in Fuxa using HEX color code #b4b4b4
    The Default Blink Interval for On and Off is 500ms but can also be changed in Fuxa in MS resolution

    <svg>
      SVG Content Here
      <script>
        JS Script Content Here
      </script>
    </svg>

    */

	  // Global Parameters and Variables

    //!export-start
    let _pn_setState = 0;                     // 0=Off, 1=Run, 2=Warn, 3=Fault, 4=Invalid, 5=Spare
    let _pb_boolState = false;                // true = Run, false = Off
    let _pn_setIntervalOn = 500;              // ms fault color is ON
    let _pn_setIntervalOff = 500;             // ms fault color is OFF
    let _pn_strokeWidth = 1;                  // Global stroke width for all states
    let _pc_fill_0 = 'none';                  // Off
    let _pc_fill_1 = 'none';                  // Run
    let _pc_fill_2 = 'none';                  // Warn
    let _pc_fill_3 = 'none';                  // Fault
    let _pc_fill_4 = 'none';                  // Invalid
    let _pc_fill_5 = 'none';                  // Spare
    let _pc_stroke_0 = '#7f7f7f';             // Off
    let _pc_stroke_1 = '#00ff00';             // Run
    let _pc_stroke_2 = '#ff9500';             // Warn
    let _pc_stroke_3 = '#ff0000';             // Fault
    let _pc_stroke_4 = '#3c3c3c';             // Invalid
    let _pc_stroke_5 = '#dcdcdc';             // Spare
    let _pb_preserveAspectRatio = true;       // true = preserve aspect ratio, false = stretch
    let _pn_rotateAngle = 0;                  // degrees, 0 = no rotation
    let _pn_rotateOffsetX = 0;                // offset from center (0 = center)
    let _pn_rotateOffsetY = 0;                // offset from center (0 = center)
    let _pb_flipHorizontal = false;           // true = flip X
    let _pb_flipVertical = false;             // true = flip Y
    let _pn_flipOffsetX = 0;                  // offset from center (0 = center)
    let _pn_flipOffsetY = 0;                  // offset from center (0 = center)
    let _pn_padding = 0;                      // padding around SVG (default 0)
    //!export-end

    let stateNumber = 0;
    let blinkInterval = null;
    let blinkTimer = null;
    let blinkObserver = null;
    let originalViewBox = null;

    // Get dynamic center from SVG viewBox (uses originalViewBox if available)
    function getCenter() {
      const svg = document.getElementById('fuxaWidget');
      const symbol = document.getElementById('fuxaSymbol');
      if (!svg) return { x: 25.5, y: 25.5 };
      if (symbol && typeof symbol.getBBox === 'function') {
        const bb = symbol.getBBox();
        return { x: bb.x + bb.width / 2, y: bb.y + bb.height / 2 };
      }
      const vbString = originalViewBox || svg.getAttribute('viewBox') || '0 0 51 51';
      const vb = vbString.split(/\s+/).map(parseFloat);
      return { x: (vb[0] + vb[2]) / 2, y: (vb[1] + vb[3]) / 2 };
    }

    // Apply transform to symbol group
    function applyTransform() {
      const symbol = document.getElementById('fuxaSymbol');
      if (!symbol) return;
      const center = getCenter();
      const cx = center.x + _pn_rotateOffsetX + _pn_flipOffsetX;
      const cy = center.y + _pn_rotateOffsetY + _pn_flipOffsetY;
      let transform = '';
      if (_pb_flipHorizontal || _pb_flipVertical) {
        const scaleX = _pb_flipHorizontal ? -1 : 1;
        const scaleY = _pb_flipVertical ? -1 : 1;
        transform += `scale(${scaleX}, ${scaleY}) translate(${scaleX === -1 ? -cx * 2 : 0}, ${scaleY === -1 ? -cy * 2 : 0}) `;
      }
      if (_pn_rotateAngle !== 0) {
        transform += `rotate(${_pn_rotateAngle}, ${cx}, ${cy}) `;
      }
      symbol.setAttribute('transform', transform.trim() || '');
    }

    // Update viewBox with padding
    function updatePadding() {
      const svg = document.getElementById('fuxaWidget');
      const symbol = document.getElementById('fuxaSymbol');
      if (!svg) return;
      const pad = Math.max(0, _pn_padding || 0);
      // Prefer persisted original viewBox (stable) — if not present, persist a computed one using getBBox
      const persisted = svg.getAttribute('data-fuxa-orig-viewbox');
      if (persisted) {
        const vb = persisted.split(/\s+/).map(parseFloat);
        const width = vb[2] - vb[0];
        const height = vb[3] - vb[1];
        const padded = Math.max(width, height);
        const size = padded + 2 * pad;
        const offsetX = (padded - width) / 2;
        const offsetY = (padded - height) / 2;
        svg.setAttribute('viewBox', `${vb[0] - pad - offsetX} ${vb[1] - pad - offsetY} ${size} ${size}`);
        return;
      }
      if (symbol && typeof symbol.getBBox === 'function') {
        // Use the actual content bounds to compute the original viewBox and persist it
        const bb = symbol.getBBox();
        const contentSize = Math.max(bb.width, bb.height);
        const size = contentSize + 2 * pad;
        const cx = bb.x + bb.width / 2;
        const cy = bb.y + bb.height / 2;
        const x = cx - size / 2;
        const y = cy - size / 2;
        const vbString = `${x} ${y} ${size} ${size}`;
        svg.setAttribute('data-fuxa-orig-viewbox', vbString);
        originalViewBox = vbString;
        svg.setAttribute('viewBox', vbString);
        return;
      }
      // Fallback to original viewBox if getBBox is not available
      const vbString = originalViewBox || svg.getAttribute('viewBox') || '0 0 51 51';
      const vb = vbString.split(/\s+/).map(parseFloat);
      const width = vb[2] - vb[0];
      const height = vb[3] - vb[1];
      const padded = Math.max(width, height);
      const size = padded + 2 * pad;
      const offsetX = (padded - width) / 2;
      const offsetY = (padded - height) / 2;
      svg.setAttribute('viewBox', `${vb[0] - pad - offsetX} ${vb[1] - pad - offsetY} ${size} ${size}`);
    }

    // Function to update preserveAspectRatio
    function updatePreserveAspectRatio() {
      const svg = document.getElementById('fuxaWidget');
      if (!svg) return;
      if (_pb_preserveAspectRatio) {
        svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
      } else {
        svg.setAttribute('preserveAspectRatio', 'none');
      }
    }

    // Function to update the color based on the set state
    function logic() {
      switch (stateNumber) {
        case 0: // off
          setBaseColor(_pc_stroke_0, _pc_fill_0);
          clearBlinking();
          break;
        case 1: // run
          setBaseColor(_pc_stroke_1, _pc_fill_1);
          clearBlinking();
          break;
        case 2: // warning
          setBaseColor(_pc_stroke_2, _pc_fill_2);
          clearBlinking();
          break;
        case 3: // fault
          const onRaw = +_pn_setIntervalOn;
          const offRaw = +_pn_setIntervalOff;
          const on = (onRaw > 0) ? Math.max(50, onRaw) : 0;
          const off = (offRaw > 0) ? Math.max(50, offRaw) : 0;

          if (on === 0 || off === 0) {
            setBaseColor(_pc_stroke_3, _pc_fill_3);
            clearBlinking();
          } else {
            startDualBlinking(_pc_stroke_0, _pc_stroke_3, _pc_fill_0, _pc_fill_3, on, off);
          }
          break;
        case 4: // invalid
          setBaseColor(_pc_stroke_4, _pc_fill_4);
          clearBlinking();
          break;
        case 5: // spare
          setBaseColor(_pc_stroke_5, _pc_fill_5);
          clearBlinking();
          break;
        default:
          console.log('Undefined State');
          clearBlinking();
      }
    }

    // Initial setup
    function init() {
      // ensure no residual timers from previous initializations
      clearBlinking();
      const svg = document.getElementById('fuxaWidget');
      if (svg) {
        // Use or persist the original viewBox to prevent cumulative padding growth
        if (!svg.getAttribute('data-fuxa-orig-viewbox')) {
          svg.setAttribute('data-fuxa-orig-viewbox', svg.getAttribute('viewBox') || '0 0 51 51');
        }
        originalViewBox = svg.getAttribute('data-fuxa-orig-viewbox');
      }
      updatePadding();
      updatePreserveAspectRatio();
      applyTransform();
      logic();
    }

    // Function to update values from Fuxa
    function putValue(id, value) {
      let needsTransform = false;

      if (id === '_pn_setState') {
        stateNumber = value;
        logic();
      }
      if (id === '_pb_boolState') {
        _pb_boolState = value;
        if (_pb_boolState === true) {
          stateNumber = 1;
        } else if (_pb_boolState === false) {
          stateNumber = 0;
        }
        logic();
      }
      if (id === '_pn_setIntervalOn') {
        _pn_setIntervalOn = value;
        if (stateNumber === 3) logic();
      }
      if (id === '_pn_setIntervalOff') {
        _pn_setIntervalOff = value;
        if (stateNumber === 3) logic();
      }
      if (id === '_pn_strokeWidth') _pn_strokeWidth = value;
      if (id === '_pc_fill_0') _pc_fill_0 = value;
      if (id === '_pc_fill_1') _pc_fill_1 = value;
      if (id === '_pc_fill_2') _pc_fill_2 = value;
      if (id === '_pc_fill_3') _pc_fill_3 = value;
      if (id === '_pc_fill_4') _pc_fill_4 = value;
      if (id === '_pc_fill_5') _pc_fill_5 = value;
      if (id === '_pc_stroke_0') _pc_stroke_0 = value;
      if (id === '_pc_stroke_1') _pc_stroke_1 = value;
      if (id === '_pc_stroke_2') _pc_stroke_2 = value;
      if (id === '_pc_stroke_3') _pc_stroke_3 = value;
      if (id === '_pc_stroke_4') _pc_stroke_4 = value;
      if (id === '_pc_stroke_5') _pc_stroke_5 = value;

      // ROTATE
      if (id === '_pn_rotateAngle') { _pn_rotateAngle = value; needsTransform = true; }
      if (id === '_pn_rotateOffsetX') { _pn_rotateOffsetX = value; needsTransform = true; }
      if (id === '_pn_rotateOffsetY') { _pn_rotateOffsetY = value; needsTransform = true; }

      // FLIP
      if (id === '_pb_flipHorizontal') {
        _pb_flipHorizontal = (value === true || value === 1 || value === '1');
        needsTransform = true;
      }
      if (id === '_pb_flipVertical') {
        _pb_flipVertical = (value === true || value === 1 || value === '1');
        needsTransform = true;
      }
      if (id === '_pn_flipOffsetX') { _pn_flipOffsetX = value; needsTransform = true; }
      if (id === '_pn_flipOffsetY') { _pn_flipOffsetY = value; needsTransform = true; }

      // PADDING
      if (id === '_pn_padding') {
        _pn_padding = Math.max(0, +value || 0);
        updatePadding();
        needsTransform = true;
      }

      // PRESERVE ASPECT RATIO
      if (id === '_pb_preserveAspectRatio') {
        _pb_preserveAspectRatio = (value === true || value === 1 || value === '1');
        updatePreserveAspectRatio();
      }

      if (needsTransform) {
        applyTransform();
      }
    }

    // Function to send values back to Fuxa (placeholder)
    function postValue(id, value) {
      console.log('Not defined!');
    }

    // Make postValue globally available only if not already set by Fuxa
    if (!window.postValue) {
      window.postValue = postValue;
    }

    // Initialize the SVG
    init();

    // Re-run init when the page becomes visible (e.g., returning from editor)
    document.addEventListener('visibilitychange', function() {
      if (document.visibilityState === 'visible') {
        setTimeout(() => init(), 10);
      }
    });

    // Function to update the color for the base shape group
    function setBaseColor(strokeColor, fillColor) {
      const symbol = document.getElementById('fuxaSymbol');
      if (!symbol) return;
      symbol.querySelectorAll('*').forEach(function(elem) {
        try {
          // Set both presentation attributes and inline styles so existing style attributes
          // (e.g., style="fill:none") are overridden by the inline style setting.
          if (fillColor !== undefined && fillColor !== null) {
            elem.setAttribute('fill', fillColor);
            elem.style.fill = fillColor;
          }
          if (strokeColor !== undefined && strokeColor !== null) {
            elem.setAttribute('stroke', strokeColor);
            elem.style.stroke = strokeColor;
          }
          elem.setAttribute('stroke-width', _pn_strokeWidth);
          elem.style.strokeWidth = String(_pn_strokeWidth);
        } catch (e) {
          // Ignore if an element doesn't accept a property
        }
      });
      applyTransform();
    }

    // DUAL BLINK: onTime (fault), offTime (off) - simple top-level tick-by-id function
    // This follows the original approach — a named top-level tick function that schedules itself.
    function fuxa_blink_tick(svgId) {
      const svg = document.getElementById(svgId);
      if (!svg) {
        clearBlinking();
        return;
      }
      if (!svg || !svg._fuxa_blink_params) return;
      const p = svg._fuxa_blink_params;
      if (svg._fuxa_blink_state) {
        setBaseColor(p.strokeOn, p.fillOn);
        svg._fuxa_blink_state = false;
        svg._fuxa_blink_timer = setTimeout(function() { fuxa_blink_tick(svgId); }, p.onTime);
      } else {
        setBaseColor(p.strokeOff, p.fillOff);
        svg._fuxa_blink_state = true;
        svg._fuxa_blink_timer = setTimeout(function() { fuxa_blink_tick(svgId); }, p.offTime);
      }
    }

    function startDualBlinking(strokeOff, strokeOn, fillOff, fillOn, onTime, offTime) {
      clearBlinking();
      // Ensure values are numbers
      onTime = Number(onTime) || 0;
      offTime = Number(offTime) || 0;
      const id = 'fuxaWidget';
      const svg = document.getElementById(id);
      if (!svg) return;
      svg._fuxa_blink_params = { strokeOff, strokeOn, fillOff, fillOn, onTime, offTime };
      svg._fuxa_blink_state = true;
      // start the tick by id (named function) for reliability
      fuxa_blink_tick(id);

      blinkObserver = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          mutation.removedNodes.forEach((node) => {
            if (node && node.id === 'fuxaWidget') {
              clearBlinking();
              if (blinkObserver) {
                blinkObserver.disconnect();
                blinkObserver = null;
              }
            }
          });
        });
      });
      blinkObserver.observe(document.body, { childList: true, subtree: true });
    }

    // FULL CLEAR BLINKING
    function clearBlinking() {
      if (blinkInterval) {
        clearInterval(blinkInterval);
        blinkInterval = null;
      }
      if (blinkTimer) {
        clearTimeout(blinkTimer);
        blinkTimer = null;
      }
      if (blinkObserver) {
        blinkObserver.disconnect();
        blinkObserver = null;
      }
      const svg = document.getElementById('fuxaWidget');
      if (svg) {
        if (svg._fuxa_blink_timer) { clearTimeout(svg._fuxa_blink_timer); svg._fuxa_blink_timer = null; }
        if (svg._fuxa_blink_params) { svg._fuxa_blink_params = null; }
        if (svg._fuxa_blink_state !== undefined) { svg._fuxa_blink_state = null; }
      }
    }]]></script>
</svg>
